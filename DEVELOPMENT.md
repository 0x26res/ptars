# Development

Most of the development tasks are expressed in the [Makefile](./Makefile)  

## Set up venv

```shell
make develop
```

### Special case for ARM mac

Add this to your bash/rc profile:

```shell
export CARGO_BUILD_TARGET=aarch64-apple-darwin
```

## Testing

```shell
cargo build && maturin develop && RUST_BACKTRACE=1 pytest python/test
```

## Releasing

- Update the version in [Cargo.toml](./Cargo.toml)
- Update cargo lock file `cargo generate-lockfile`
- Update the version in [pyproject.toml](./pyproject.toml)
- Update the uv lock file `uv lock --upgrade`
- Update the uv lock file `pre-commit autoupdate && pre-commit run --all-files`
- Tag and push the tag (don't forget to preprend a `v` to the version when tagging)

Note: the ci script is autogenerated:

```shell
make generate-ci
```

## Benchmarking

Make sure to install the release version of ptars.
The locally built version is much slower.

```shell
make benchmark
```

## TODO

- [ ] add configuration for enums, timestamp, date, wrapped types, duration
- [ ] add python documentation

## Resources

- [Blog on how to develop](https://blog.yossarian.net/2020/08/02/Writing-and-publishing-a-python-module-in-rust?utm_source=pocket_saves)
  and [Corresponding repo](https://github.com/woodruffw/procmaps.py)
- [PyO3 get started](https://pyo3.rs/v0.4.1/) and  [Pyo3 with poetry](https://github.com/nbigaouette/python-poetry-rust-wheel/)
- [Maturin "Mixed Source"](https://www.maturin.rs/#mixed-rustpython-projects)
- [arrow builder example](https://github.com/apache/arrow-rs/blob/master/arrow/examples/builders.rs)
